---
export const prerender = true;
import BaseLayout from "../../layouts/BaseLayout.astro";
import Header from "../../components/Header.astro";
import BlogGrid from "../../components/BlogGrid.astro";
import Pagination from "../../components/Pagination.astro";
import Footer from "../../components/Footer.astro";
import { getCollection } from "astro:content";

const POSTS_PER_PAGE = 6;
const currentPage = 1;

const allPosts = (
  await getCollection("blog", ({ data }) => data.published === true)
).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const totalPages = Math.ceil(allPosts.length / POSTS_PER_PAGE);
const posts = allPosts.slice(0, POSTS_PER_PAGE);
---

<BaseLayout title="TinkerDrop">
  <Header />
  <main>
    <section>
      <BlogGrid posts={posts} />
    </section>

    {
      totalPages > 1 && (
        <Pagination
          currentPage={currentPage}
          totalPages={totalPages}
          baseUrl="/blog/page/"
          firstPageUrl="/blog/"
        />
      )
    }
  </main>
  <Footer />
</BaseLayout>
